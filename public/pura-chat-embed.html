<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pura Chat</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      background: transparent;
      overflow: hidden;
    }
    
    /* Hide ALL floating/fixed positioned elements except the main chat window */
    body > div[style*="position: fixed"]:not(.lc-chat-widget):not([class*="chat-window"]) {
      display: none !important;
      visibility: hidden !important;
    }
    
    /* Hide the floating launcher bubble */
    .lc-chat-widget-button,
    [class*="chat-widget-launcher"],
    [class*="widget-launcher"],
    .lc_text-widget-open,
    [class*="lc-"][class*="launcher"],
    [class*="lc-"][class*="bubble"],
    [class*="lc-"][class*="fab"],
    [class*="lc-"][class*="trigger"],
    button[class*="lc-"]:not([class*="send"]):not([type="submit"]) {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      pointer-events: none !important;
      width: 0 !important;
      height: 0 !important;
    }
    
    /* Force the chat window to fill the container and stay contained */
    .lc-chat-widget,
    [class*="chat-widget-container"],
    [class*="lc-widget"],
    .lc_text-widget,
    .lc-1mw06hm {
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      width: 100% !important;
      height: 100% !important;
      max-width: 100% !important;
      max-height: 100% !important;
      border-radius: 0 !important;
      box-shadow: none !important;
      transform: none !important;
      margin: 0 !important;
    }
    
    /* Make chat input and message area fit properly */
    [class*="lc-"] input,
    [class*="lc-"] textarea,
    [class*="chat-widget"] input,
    [class*="chat-widget"] textarea {
      font-size: 14px !important;
      padding: 10px 12px !important;
      max-width: 100% !important;
      box-sizing: border-box !important;
    }
    
    /* Ensure message container fills available space */
    [class*="message-container"],
    [class*="chat-body"],
    [class*="lc-"][class*="messages"] {
      flex: 1 !important;
      overflow-y: auto !important;
      overflow-x: hidden !important;
    }
    
    /* Input area stays at bottom */
    [class*="input-area"],
    [class*="chat-input"],
    [class*="lc-"][class*="footer"],
    [class*="lc-"][class*="input"] {
      position: relative !important;
      width: 100% !important;
      padding: 8px !important;
      background: inherit !important;
      box-sizing: border-box !important;
    }
    
    /* Hide any standalone floating elements outside main widget */
    body > div[style*="position: fixed"]:not([class*="chat-widget"]):not([class*="lc-chat"]) {
      display: none !important;
    }
    
    /* Loading state - matches React design */
    .loading-state {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: white;
      font-family: 'Quicksand', system-ui, sans-serif;
      color: hsl(262 20% 40%);
      gap: 16px;
      padding: 20px;
    }
    
    .loading-state.hidden {
      display: none;
    }
    
    .chat-icon-wrapper {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: linear-gradient(135deg, hsl(262 83% 58%) 0%, hsl(330 80% 60%) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 20px hsl(262 83% 58% / 0.3);
    }
    
    .chat-icon-wrapper svg {
      width: 28px;
      height: 28px;
      color: white;
    }
    
    .loading-text {
      font-family: 'Outfit', 'Quicksand', system-ui, sans-serif;
      font-size: 16px;
      font-weight: 600;
      color: hsl(270 50% 12%);
    }
    
    .loading-subtext {
      font-size: 13px;
      color: hsl(270 20% 50%);
      text-align: center;
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@500;600&family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="loading-state" id="loadingState" onclick="forceOpenWidget()" style="cursor: pointer;">
    <div class="chat-icon-wrapper">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
      </svg>
    </div>
    <div class="loading-text">Start chatting with Pura</div>
    <div class="loading-subtext">Click here to begin your venue match</div>
  </div>

  <!-- GHL Chat Widget -->
  <script src="https://widgets.leadconnectorhq.com/loader.js" 
          data-resources-url="https://widgets.leadconnectorhq.com/chat-widget/loader.js"
          data-widget-id="69584d089b31e93877c9c8f6">
  </script>

  <script>
    // Force open the chat widget once it loads
    function forceOpenWidget() {
      // Try to open using leadConnector API
      if (window.leadConnector && window.leadConnector.chatWidget) {
        var cw = window.leadConnector.chatWidget;
        if (typeof cw.openWidget === 'function') {
          cw.openWidget();
          hideLoading();
          return true;
        }
        if (typeof cw.open === 'function') {
          cw.open();
          hideLoading();
          return true;
        }
      }
      
      // Try LC_API
      if (window.LC_API && typeof window.LC_API.open_chat_window === 'function') {
        window.LC_API.open_chat_window();
        hideLoading();
        return true;
      }
      
      // Try clicking the launcher
      var selectors = [
        '.lc-chat-widget-button',
        '[class*="chat-widget"] button',
        '[class*="lc_text-widget"]',
        '.lc_text-widget-open'
      ];
      
      for (var i = 0; i < selectors.length; i++) {
        var el = document.querySelector(selectors[i]);
        if (el) {
          el.click();
          hideLoading();
          return true;
        }
      }
      
      return false;
    }
    
    function hideLoading() {
      var loader = document.getElementById('loadingState');
      if (loader) {
        loader.classList.add('hidden');
      }
    }

    // Allow parent-page CTAs to request the widget to open.
    window.openPuraChatWidget = forceOpenWidget;
    window.addEventListener('message', function (event) {
      try {
        var data = event && event.data;
        if (!data) return;
        if (data === 'PURA_CHAT_OPEN' || (typeof data === 'object' && data.type === 'PURA_CHAT_OPEN')) {
          console.log('[Pura Embed] Received PURA_CHAT_OPEN');
          forceOpenWidget();
        }
      } catch (e) {
        console.log('[Pura Embed] message handler error', e);
      }
    });
    
    // Poll until widget is ready
    var attempts = 0;
    var maxAttempts = 30;
    var interval = setInterval(function() {
      attempts++;
      
      if (forceOpenWidget()) {
        clearInterval(interval);
        return;
      }
      
      // Check if any widget element exists (even if API not ready)
      var widgetExists = document.querySelector('[class*="lc-"], [class*="chat-widget"]');
      if (widgetExists) {
        hideLoading();
      }
      
      if (attempts >= maxAttempts) {
        clearInterval(interval);
        hideLoading();
      }
    }, 300);
  </script>
</body>
</html>
